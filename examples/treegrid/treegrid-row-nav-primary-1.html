<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />

<!--
  Give this example implementation a name and put it in the title element,
  e.g., "Checkbox" if implementing the checkbox pattern.
  The name should be unique if the pattern will have multiple implementations,
  e.g., "Simple Two-State Checkbox" or "Three-State Checkbox".
-->
<title>Treegrid Email Inbox Example | WAI-ARIA Authoring Practices 1.1</title>

<!--  Core js and css shared by all examples; do not modify when using this template. -->
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css">
<link rel="stylesheet" href="../css/core.css">
<script src="../js/examples.js"></script>
<script src="../js/highlight.pack.js"></script>
<script src="../js/app.js"></script>

<!--  js and css for this example. -->
<link href="css/treegrid-row-nav-primary-1.css" rel="stylesheet">
<script src="js/treegrid-row-nav-primary-1.js" type="text/javascript"></script>
</head>
<body>
  <main>
  <h1>Treegrid Email Inbox Example</h1>
  <p>
    <strong>NOTE:</strong> This example page is not yet complete.
    Development of this example is tracked by
    <a href="https://github.com/w3c/aria-practices/issues/132">issue 132.</a>
  </p>
  <p>
    The following example demonstrates how the
    <a href="../../#treegrid">treegrid design pattern (TBD)</a>
    can be used to make an interactive tree that enables users to navigate the hierarchical structure of email conversations
    and also provides the ability to navigate to elements that describe each email, such as subject and sender.
  </p>
  <p>
    This example is like a tree with cells, and on first entry a row is focused.
    Other treegrids which may act more like a grid and focus a cell on first entry, with some cells containing buttons to reveal or hide further sections of the grid.
  </p>

  <section>
    <h2 id="ex_label">Example</h2>
    <div role="separator" id="ex_start_sep" aria-labelledby="ex_start_sep ex_label" aria-label="Start of"></div>
    <!--
      Note the ID of the following div that contains the example HTML is used as a parameter for the sourceCode.add() function.
      The sourceCode functions in the examples/js/examples.js render the HTML source to show it to the reader of the example page.
      If you change the ID of this div, be sure to update the parameters of the sourceCode.add() function call, which is made following the div with id="sc1" where the HTML is render.
      The div for the rendered HTML source is in the last section of the page.
    -->
    <div id="ex1">
      <table id="treegrid" role="treegrid" aria-readonly="true" aria-label="ARIA treegrid example">
        <colgroup>
          <col id="treegrid-col1">
          <col id="treegrid-col2">
          <col id="treegrid-col3">
        </colgroup>
        <thead>
          <tr>
            <th role="columnheader">Subject</th>
            <th role="columnheader">Summary</th>
            <th role="columnheader">Email</th>
          </tr>
        </thead>
        <tbody>
          <tr role="row" aria-level="1" aria-posinset="1" aria-setsize="1" aria-expanded="true">
            <td role="gridcell">Treegrids are broken</td>
            <td role="gridcell">How do we fix them?</td>
            <td role="gridcell"><a href="mailto:aaron@thegoogle.rocks">aaron@thegoogle.rocks</a></td>
          </tr>
          <tr role="row" aria-level="2" aria-posinset="1" aria-setsize="3">
             <td role="gridcell">re: Treegrids are broken</td>
             <td role="gridcell">I agree with you, but ...</td>
             <td role="gridcell"><a href="mailto:joe@blahblahblah.blahblah">joe@blahblahblah.blahblah</a></td>
          </tr>
          <tr role="row" aria-level="2" aria-posinset="2" aria-setsize="3" aria-expanded="true">
             <td role="gridcell">re: Treegrids are broken
             <td role="gridcell">Not that many people use them
             <td role="gridcell"><a href="mailto:billy@dangerous.fish">billy@dangerous.fish</a></td>
          </tr>
          <tr role="row" aria-level="3" aria-posinset="1" aria-setsize="1">
             <td role="gridcell">re: Treegrids are broken</td>
             <td role="gridcell">We still need them, plus it's a spec hole</td>
             <td role="gridcell"><a href="mailto:doris@rufflazydogs.sleep">doris@rufflazydogs.sleep</a></td>
          </tr>
          <tr role="row" aria-level="2" aria-posinset="3" aria-setsize="3" aria-expanded="true">
             <td role="gridcell">re: Treegrids are broken</td>
             <td role="gridcell">Can someone suggest something?</td>
             <td role="gridcell"><a href="mailto:someone@please-do-it.company">someone@please-do-it.company</a></td>
          </tr>
          <tr role="row" aria-level="3" aria-posinset="1" aria-setsize="1" aria-expanded="false">
             <td role="gridcell">re: Treegrids are broken</td>
             <td role="gridcell">They are more like trees than grids, not that many columns usually</td>
             <td role="gridcell"><a href="mailto:mari@beingpractical.com">mari@beingpractical.com</a></td>
          </tr>
          <tr role="row" aria-level="4" aria-posinset="1" aria-setsize="2" aria-hidden="true">
             <td role="gridcell">re: Treegrids are broken</td>
             <td role="gridcell">Cool, let's keep left/right collapse/expand like a tree</td>
             <td role="gridcell"><a href="mailto:issie@imadeadcatsadly.wascute">issie@imadeadcatsadly.wascute</a></td>
          </tr>
          <tr role="row" aria-level="4" aria-posinset="2" aria-setsize="2" aria-hidden="true">
             <td role="gridcell">re: Treegrids are broken
             <td role="gridcell">There be a column navigation command</td>
             <td role="gridcell"><a href="mailto:kitten@kittenseason.future">kitten@kittenseason.future</a></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div role="separator" id="ex_end_sep" aria-labelledby="ex_end_sep ex_label" aria-label="End of"></div>
    <h4>Notes</h4>
    <p>In general, this type of treegrid acts mostly as a tree with cells. The interactions
    are the same as a tree, until one begins navigating by cells (via tab to an interactive cell or
    right arrow on an expanded row).</p>

  </section>

  <section>
    <h2>Accessibility Features</h2>
    <p>Markup used:</p>
    <ul>
      <li>roles used are treegrid, row, gridcell and columnheader.</li>
      <li>aria-level: used to set the current level of an item, 1, 2, 3, etc.</li>
      <li>aria-posinset, aria-setsize: used on a row to indicate the position of an item within it's local group, such as item 3 of 5. Unfortunately, <a href="https://github.com/w3c/aria/issues/558">aria-posinset and aria-setsize are not currently legal in the spec (bug filed)</a>. Therefore, <a href="https://bugzilla.validator.nu/show_bug.cgi?id=1033">aria-posinset and aria-setsize are not currently supported on role="row" in the Nu Validator (bug filed)</a>. We'll need to work that in as this is the most practical way of implementing ARIA in many existing treegrid libraries (as opposed to rearchitecting the
      DOM structure to contain rowgroups). Note that the <a href="https://github.com/w3c/aria/issues/553">ARIA spec's text for rowgroup states that it cannot be parented by a treegrid (bug filed)</a>.</li>
      <li>aria-expanded (tristate): this attribute must be removed (not present) if the item cannot be expanded. For expandable items, the value is "true" or "false"</li>
      <li>aria-hidden: set to "true" for child items that are currently hidden because the parent is collapsed.</li>
      <li>aria-readonly: in ARIA 1.0, a grid/treegrid is editable by default. However, there is no default in ARIA 1.1. Firefox currently implements the ARIA 1.0 concept for this, which means that "editable" is read for every cell unless aria-readonly="true" is used on the treegrid. There needs to be some follow up with user agent developers on this, as ARIA 1.1 seems to be treating it more a tristate (don't care, false, true). In addition, <a href="https://github.com/w3c/aria/issues/550">a bug was filed on the spec regarding aria-readonly but it is possibly invalid</a>.</li>
      <li>tabindex is set in the JS, as per the usual roving tabindex methodology. Specifically, we use tabindex="0" for the current item so that it is the subitem that gets focused if user tabs out and back in, and tabindex="-1" for all items where we want click-to-focus behavior enabled.</li>
    </ul>

    <p>Not used in this example:</p>
    <ul>
      <li>aria-rowindex, aria-rowcount, aria-colindex, aria-colcount are not currently used, as UA/AT can compute this for fully loaded table DOMs.</li>
      <li>aria-owns: not currently used, as it would be confusing to have conceptual children (other rows) vs. layout children (cells) being on the same level.</li>
      <li>aria-activedescendant: this example uses to roaming tabindex method instead.</li>
      <li>aria-multiselectable and aria-selected: used on row in the case of a multiselectable treegrid where each row begins with a checkbox. Must be set to false or true so that it is clear that row is selectable. Unfortunately some screen readers will read "selected" for each row even in the single selection case.</li>
      <li>aria-labelledby or aria-describedby for headers? Not currently used, awaiting discussion. Some UA + screen reader combinations seem to be determining this automatically via the table structure.</li>
    </ul>

  </section>

  <section>
    <h2 id="kbd_label">Keyboard Support</h2>

    <p>Note (TBD): the behavior for <kbd>Left arrow</kbd> and <kbd>Right arrow</kbd> should be switched for right-to-left language content!!</p>

    <table aria-labelledby="kbd_label" class="def">
      <thead>
        <tr>
          <th>Key</th>
          <th>Function</th>
        </tr>
      </thead>
      <tbody>
      <tr>
        <th scope="row">
          <kbd>Right Arrow</kbd>
        </th>
        <td>
          <ul>
            <li>If a row is focused, and it is collapsed, expands the current row.</li>
            <li>If a row is focused, and it is expanded, focuses the first cell in the row.</li>
            <li>If a cell is focused, moves one cell to the right.</li>
            <li>If focus is on the right most cell, focus does not move.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Left Arrow</kbd>
        </th>
        <td>
          <ul>
            <li>If a row is focused, and it is expanded, collapses the current row.</li>
            <li>If a row is focused, and it is collapsed, moves to the parent row (if there is one).</li>
            <li>If a cell in the first column is focused, focuses the row.</li>
            <li>If a cell in a different column is focused, moves focus one cell to the left.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Down Arrow</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus one row or one cell down, depending on whether a row or cell is currently focused.</li>
            <li>If focus is on the bottom row, focus does not move.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Up Arrow</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus one row or one cell up, depending on whether a row or cell is currently focused.</li>
            <li>If focus is on the top row, focus does not move.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Tab</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus to the next interactive cell in the current row.</li>
            <li>If there are no more interactive cells in the current row,
              moves out of the treegrid.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Shift + Tab</kbd>
        </th>
        <td>
          <ul>
            <li>If a cell is focused, moves focus to the previous interactive cell in the current row.</li>
            <li>If a row is focused, moves out of the treegrid.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Home</kbd>
        </th>
        <td>
          <ul>
            <li>If a row is focused, moves to the first row.</li>
            <li>If a cell is focused, moves focus to the row's first cell.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>End</kbd>
        </th>
        <td>
          <ul>
            <li>If a row is focused, moves to the last row.</li>
            <li>If a cell is focused, moves focus to the row's last cell.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Control + Home</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus to the first row.</li>
            <li>If a cell was focused, focus is kept in the same column,
              otherwise the entire first row is focused.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Control + End</kbd>
        </th>
        <td>
          <ul>
            <li>Moves focus to the last row.</li>
            <li>If a cell was focused, focus is kept in the same column,
              otherwise the entire last row is focused.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Enter</kbd>
        </th>
        <td>
          <ul>
            <li>Performs default action on row or cell, e.g. opens message or navigate to link.</li>
            <li>If focus is on the cell with the expand/collapse button, and there is no other action,
              will toggle expansion of the current row.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th scope="row">
          <kbd>Space</kbd>
        </th>
        <td>
          <ul>
            <li>In the case of multiselect treegrid, can be used to check a selection checkbox</li>
          </ul>
        </td>
      </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2 id="rps_label">Role, Property, State, and Tabindex  Attributes</h2>
    <!--
      Update this table to describe how roles, properties, states, and tabindex are used in this example.
    -->
    <table aria-labelledby="rps_label" class="data attributes">
      <thead>
        <tr>
          <th scope="col">Role</th>
          <th scope="col">Attribute</th>
          <th scope="col">Element</th>
          <th scope="col">Usage</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row"><code>RoleName</code></th>
          <td><!--  Leave this cell blank in rows where a role is being described. --></td>
          <td><code>HTML_ELEMENT</code></td>
          <td>
            Describe usage/purpose, e.g., indicates the focusable element that serves as the ...
          </td>
        </tr>
        <tr>
          <td>
            <!--  Leave this cell blank in rows that describe attributes applied to the element with the previously described role.
              Make a row like this for each attribute/value pair.
          -->
          </td>
          <th scope="row"><code>AttributeName=<q>AttributeValue</q></code></th>
          <td><code>HTML_ELEMENT</code></td>
          <td>
            <ul>
              <li>explanation of usage, purpose, benefit, and/or guidance relevant to this implementation.</li>
              <li>If making multiple statements, use list for brevity and clarity</li>
              <li>Do not make a single item list.</li>
            </ul>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>Javascript and CSS Source Code</h2>
    <!--  After the js and css files are named with the name of this example, change the href and text of the following 2 links to refer to the appropriate js and css files.  -->
    <ul>
      <li>
        CSS:
        <a href="css/example_name.css" type="tex/css">example_name.css</a>
      </li>
      <li>
        Javascript:
        <a href="js/example_name.js" type="text/javascript">example_name.js</a>
      </li>
    </ul>
  </section>

  <section>
    <h2 id="sc1_label">HTML Source Code</h2>
    <div role="separator" id="sc1_start_sep" aria-labelledby="sc1_start_sep sc1_label" aria-label="Start of"></div>
    <pre><code id="sc1"></code></pre>
    <div role="separator" id="sc1_end_sep" aria-labelledby="sc1_end_sep sc1_label" aria-label="End of"></div>
    <!--
      The following script will show the reader the HTML source for the example that is in the div with ID 'ex1'.
      It renders the HTML in the preceding pre element with ID 'sc1'.
      If you change the ID of either the 'ex1' div or the 'sc1' pre, be sure to update the sourceCode.add function parameters.
      -->
    <script>
      sourceCode.add('sc1', 'ex1');
      sourceCode.make();
    </script>
  </section>
  </main>
  <nav>
    <!--  Update the pattern_ID parameter of this link to refer to the APG design pattern section related to this example.  -->
    <a href="../../#pattern_ID">EXAMPLE_NAME Design Pattern in WAI-ARIA Authoring Practices 1.1</a>
  </nav>
</body>
</html>
